= Intershop Commerce Management Project Plugins
:latestRevision: 2.0.0
:toc:
:icons: font

== Summary
This plugin collection contains plugins for building all necessary artifacts of an
Intershop Commerce Management Server.

== Intershop Commerce Management Cartridge Plugins

image::images/CartridgePlugins.png[Cartrdige Plugins, 500]

The abstract Cartridge plugin adds a pom property "cartridge.style" if
the https://docs.gradle.org/current/userguide/publishing_maven.html[Gradle "Maven Publish Plugin"] is applied.

=== Product Cartridge Plugin
This plugin applies the "Public Cartridge Plugin" and add an extra property
"cartridge.style" to the Cartridge project. The value of the property is "cartridge". This value is also set
for the pom property. It should be applied to projects for further development.

++++
<details open>
<summary>Groovy</summary>
++++
.build.gradle
[source,groovy]
----
plugins {
    id 'com.intershop.icm.cartridge.public' version '{latestRevision}'
}
----
++++
</details>
++++

++++
<details>
<summary>Kotlin</summary>
++++
.build.gradle.kts
[source,kotlin]
----
plugins {
    id("com.intershop.icm.cartridge.public") version "{latestRevision}"
}
----
++++
</details>
++++

=== Adapter Cartridge Plugin
This plugin applies the "External Cartridge Plugin" and add an extra property
"cartridge.style" to the Cartridge project. The value of the property is "adapter" and is also
set to the pom property. This plugin should be applied to special adapter Cartridges like
payment or search connectors.

++++
<details open>
<summary>Groovy</summary>
++++
.build.gradle
[source,groovy]
----
plugins {
    id 'com.intershop.icm.cartridge.adapter' version '{latestRevision}'
}
----
++++
</details>
++++

++++
<details>
<summary>Kotlin</summary>
++++
.build.gradle.kts
[source,kotlin]
----
plugins {
    id("com.intershop.icm.cartridge.adapter") version "{latestRevision}"
}
----
++++
</details>
++++

=== Development Cartridge Plugin
This plugin applies the "External Cartridge Plugin" and add an extra property
"cartridge.style" to the Cartridge project. The value of the property is "development".
This plugin should be applied to special development projects. This kind of Cartridges are not available
on a production or test container.
++++
<details open>
<summary>Groovy</summary>
++++
.build.gradle
[source,groovy]
----
plugins {
    id 'com.intershop.icm.cartridge.development' version '{latestRevision}'
}
----
++++
</details>
++++

++++
<details>
<summary>Kotlin</summary>
++++
.build.gradle.kts
[source,kotlin]
----
plugins {
    id("com.intershop.icm.cartridge.development") version "{latestRevision}"
}
----
++++
</details>
++++

=== Test Cartridge Plugin
This plugin applies the "Cartridge Plugin" and add an extra property
"cartridge.style" to the Cartridge project. The value of the property is "test".
This plugin should be applied to special test projects. This kind of Cartridges are not available
on a production container.

++++
<details open>
<summary>Groovy</summary>
++++
.build.gradle
[source,groovy]
----
plugins {
    id 'com.intershop.icm.cartridge.test' version '{latestRevision}'
}
----
++++
</details>
++++

++++
<details>
<summary>Kotlin</summary>
++++
.build.gradle.kts
[source,kotlin]
----
plugins {
    id("com.intershop.icm.cartridge.test") version "{latestRevision}"
}
----
++++
</details>
++++

=== Cartridge Plugin
* This plugin applies the https://docs.gradle.org/current/userguide/java_plugin.html#header[Gradle "Java Plugin"]
to the project.
* It applies two configurations
** `cartridge` and
** `cartridgeRuntime` +
to the project.
* The following tasks are added by the plugin:
** `writeCartridgeDescriptor`
** `writeCartridgeClasspath` - depends on the Gradle property `classpath.file.enabled`
** `copyThirdpartyLibs`

The tasks "writeCartridgeDescriptor" and "writeCartridgeClasspath" are grouped by the task "writeCartridgeFiles". i
It is not necessary to apply this plugin to a project separately, because it was applied by some of the plugins above.

==== Configurations
[cols="15%,15%,15%,54%", width="99%, options="header"]
|===
| Configuration name | Transitive | Extends         | Usage

| *cartridge*        | `false`      | `implementation`| for Cartridge dependencies
| *cartridgeRuntime* | `true`       | `cartridge`     | for Cartridge runtime dependencies
|===

==== Tasks
[cols="26%,33%,40%", width="99%, options="header"]
|===
| Task name                  | Class                              |Description

| *writeCartridgeDescriptor* | `com.intershop.gradle.icm.tasks +
WriteCartridgeDescriptor` | Creates a the Cartridge descriptor file `cartridge.descriptor`.
| *writeCartridgeClasspath*  | `com.intershop.gradle.icm.tasks +
WriteCartridgeClasspath` | Creates a the Cartridge classpath file `cartridge.classpath` for ICM server projects.
This task is only configured if the Gradle property `classpath.file.enabled` is true. <<anchor-1,[1]>>
| *copyThirdpartyLibs*       | `com.intershop.gradle.icm.tasks +
CopyThirdpartyLibs` | Copies all 3rd party libraries to one build directory. File located in the container of the
base project are not copied.<<anchor-2,[2]>>
|===

[[anchor-1]][1] The default value of "classpath.file.enabled" is false.

[[anchor-2]][2] Files, installed on the container of the base project, will be not copied, if the base project provides
a filter file. There is also a special setting in the extension possible. List entries have the following form:
``<group name>-<module name>-<version>``.

=== Public Cartrige Plugin
This plugin applies the
https://docs.gradle.org/current/userguide/publishing_maven.html[Gradle "Maven Publish Plugin"]
to a project and configures the publication of a plugin for further development.
It adds the project library, the source and and Java doc jars to the publication and
the description and the inception year to the pom.
Furthmore the pom property "cartridge.name" is added to the publishing configuration.

It is not necessary to apply this plugin to a project separately, because it was applied by some of the plugins above.

This plugin applies the
https://docs.gradle.org/current/userguide/publishing_maven.html[Gradle "Maven Publish Plugin"]
to a project.

=== External Cartridge Plugin
This plugin applies the "Public Cartridge Plugin". It adds  the task `zipStaticFiles` for publishing. Furthermore the output of the task `writeCartridgeDescriptor` is added
to the `zipStaticFiles`. The pom property `cartridge.type` is set to `external`.
This plugin is used for Cartridges, that will be available for projects based on the Intershop Commerce Management server.
These Cartridges will be added to the project configuration for development, test purposes and also for
special feature sets.

==== Tasks
[cols="26%,33%,40%", width="99%, options="header"]
|===
| Task name                  | Class                              |Description

| *zipStaticFiles* | `com.intershop.gradle.icm.tasks +
ZipStaticFiles` | Creates a zip file with the static Cartridge content.
|===

++++
<details open>
<summary>Groovy</summary>
++++
.build.gradle
[source,groovy]
----
plugins {
    id 'com.intershop.icm.cartridge.test' version '{latestRevision}'
    id 'com.intershop.icm.cartridge.external' version '{latestRevision}'
}
----
++++
</details>
++++

++++
<details>
<summary>Kotlin</summary>
++++
.build.gradle.kts
[source,kotlin]
----
plugins {
    id("com.intershop.icm.cartridge.test") version "{latestRevision}"
    id("com.intershop.icm.cartridge.external") version "{latestRevision}"
}
----
++++
</details>
++++

This will configure a test Cartridge for external usage.

== Intershop Commerce Management Base Plugin
This plugin will be applied to a root project of an Intershop Commerce Management project with Cartridge sub projects.
It configures all sub projects and the root project self.

The plugin applies the
https://docs.gradle.org/current/userguide/publishing_maven.html[Gradle "Maven Publish Plugin"] to the root
project and it creates the configurations `cartridge` and `cartridgeRuntime` in the root and all sub projects.

=== Plugin Configuration

++++
<details open>
<summary>Groovy</summary>
++++
.build.gradle
[source,groovy]
----
plugins {
    id 'com.intershop.gradle.icm.base' version '{latestRevision}'
}

intershop {

    projectInfo {
        productID = 'ICM 7 B2C'
        productName = 'Intershop Commerce Management 7 B2C'
        copyrightOwner = 'Intershop Communications'
        copyrightFrom = '2005'
        organization = 'Intershop Communications'
    }

    mavenPublicationName = 'ishmvn'
}
----
++++
</details>
++++

++++
<details>
<summary>Kotlin</summary>
++++
.build.gradle.kts
[source,kotlin]
----
plugins {
    id("com.intershop.gradle.icm.base") version "{latestRevision}"
}

intershop {

    projectInfo {
        productID.set("ICM 7 B2C")
        productName.set("Intershop Commerce Management 7 B2C")
        copyrightOwner.set("Intershop Communications")
        copyrightFrom.set("2005")
        organization.set("Intershop Communications")
    }

    mavenPublicationName.set("ishmvn")
}
----
++++
</details>
++++

The project information (`projectInfo`) is used in the display of the login dialog of the the ICM backoffice.

==== Extension 'intershop' for Base Plugin

===== Properties

[cols="25%,10%,10%,55%", width="99%, options="header"]
|===
|Property               | Type      | Default value | Description

|`mavenPublicationName` | `String`  | `mvn` | The property is used for the publishing configuration.
|===

===== Methods

[cols="17%,17%,66%", width="99%, options="header"]
|===
|Method | Parameter | Description

|`developmentConfig` | `Action<in `DevelopmentConfiguration`>` | Configures a development configuration from an action.
|`developmentConfig` | `Closure<Any>` | Configures a development configuration from a closure.
|`projectInfo` | `Action<in ProjectInfo>` | Configures a project information from an action.
|`projectInfo` | `Closure<Any>` | Configures a project information from a closure.
|===

===== Object `DevelopmentConfiguration`
====== Properties

[cols="20%,10%,50%,30%", width="99%, options="header"]
|===
|Property           | Type     | Default value | Description

|`licenseDirectory` | `String` |
One of these values in the following order: +
1. value of environement variable `LICENSEDIR` +
2. value of system property `licenseDir` +
3. value of Gradle property `licenseDir` +
4. default value `$GRADLE_USER_HOME/icm-default/lic` | Path of a directory with the
Intershop license file. This is required by an ICM server instance.
|`licenseFilePath`  | `String` | `<licenseDirectory>/license.xml` |The absolute path of the license file.
|`configDirectory`  | `String` |
One of these values in the following order: +
1. value of environement variable `CONFIGDIR` +
2. value of system property `configDir` +
3. value of Gradle property `configDir` +
4. default value `$GRADLE_USER_HOME/icm-default/conf` |Path of a directory with an
local environment specific configuration file. This is necessary to overwrite an existing
configuration of a server, such as the database settings.
|`configFilePath`   | `String` | `<configDirectory>/cluster.properties` | The absolute path of the configuration file.
|===

NOTE: All properties are read only.

===== Object `ProjectInfo`
====== Properties

[cols="20%,10%,5%,30%,45%", width="99%, options="header"]
|===
|Property           | Type                  | Read only | Default value | Description

|`productIDProvider`     | `Provider<String>` | x | `productID` instance | Provider of the product ID of the project.
|`productID`             | `Property<String>` | | *`ICM`* | Product ID property.
|`productNameProvider`   | `Provider<String>` | x | `productName` instance | Provider of the product name of the project.
|`productName`           | `Property<String>` | | *`Intershop Commerce Management 7`* | Product name property.
|`copyrightOwnerProvider`| `Provider<String>` | x | `copyrightOwner` instance | Provider of the copyright owner of the project.
|`copyrightOwner`        | `Property<String>` | | *`Intershop Communications`* | Copyright owner property.
|`copyrightFromProvider`| `Provider<String>` | x | `copyrightFrom` instance| Provider of the 'copyright from' property.
|`copyrightFrom`        | `Property<String>` | | *`2005`* | 'Copyright from' property.
|`organizationProvider` | `Provider<String>` | x | `organization` instance | Provider of the organization property.
|`organization`         | `Property<String>` | | *`Intershop Communications`* | Organization property.
|===

=== Dependency Configurations
[cols="15%,15%,15%,54%", width="99%, options="header"]
|===
| Configuration name | Transitive | Extends         | Usage

| *cartridge*        | `false`      | `implementation`| for Cartridge dependencies
| *cartridgeRuntime* | `true`       | `cartridge`     | for Cartridge runtime dependencies
|===

=== Tasks
[cols="26%,33%,40%", width="99%, options="header"]
|===
| Task name                  | Class                              |Description

| *allDependencies*    | `org.gradle.api.tasks.diagnostics +
DependencyReportTask` | Displays the dependency tree for a project. An instance of this type is used when you
execute the dependencies task from the command-line.
| *createServerInfo*    | `com.intershop.gradle.icm.tasks +
CreateServerInfo`  | Creates a properties file with all project information.
This property is used by the server.
| *createClusterID*     | `com.intershop.gradle.icm.tasks +
CreateClusterID` |  This taks creates an UID with Java functionality in the required format for the server.
| *writeCartridgeFiles* | `org.gradle.api +
Task`  | This task groups two tasks of a cartridge (`writeCartridgeDescriptor`, `writeCartridgeClasspath`)
|===

== Intershop Commerce Management Project Plugin

This plugin applies the Intershop Commerce Management Base plugin to the project. It adds also additional tasks and
configuration for projects that are based on an Intershop Commerce Management base project like Intershop Commerce Management B2X 7.11.
A base project proivides a container with an installed server configuration.

=== Plugin Configuration

++++
<details open>
<summary>Groovy</summary>
++++
.build.gradle
[source,groovy]
----
plugins {
    id 'com.intershop.gradle.icm.base' version '{latestRevision}'
}

intershop {

    projectInfo {
        productID = 'ICM 7 Project'
        productName = 'Intershop Commerce Management 7 Project'
        copyrightOwner = 'Intershop Communications'
        copyrightFrom = '2005'
        organization = 'Intershop Communications'
    }

    mavenPublicationName = 'ishmvn'

    projectConfig {
        cartridges = [ 'com.intershop.cartridge:cartridge_dev:1.0.0',
                       'projectCartridge_prod',
                       'com.intershop.cartridge:cartridge_prod:1.0.0',
                       'projectCartridge_test']

        dbprepareCartridges = [ 'projectCartridge_prod',
                                'com.intershop.cartridge:cartridge_prod:1.0.0' ]

        base {
            dependency = "com.intershop.icm:icm-as:1.0.0"
        }

        modules {
            solr {
                dependency = "com.intershop.search:solrcloud:1.0.0"
            }
            payment {
                dependency = "com.intershop.payment:payment:1.0.0"
            }
        }
        serverDirConfig {
            base {
                sites {
                    dirs {
                        main {
                            dir.set(file("sites/base"))
                        }
                    }
                }
                config {
                    dirs {
                        main {
                            dir.set(file("config/base"))
                        }
                    }
                }
            }
            prod { }
            test { }
            dev { }
        }
    }
}
----
++++
</details>
++++

++++
<details>
<summary>Kotlin</summary>
++++
.build.gradle.kts
[source,kotlin]
----
plugins {
    id("com.intershop.gradle.icm.base") version "{latestRevision}"
}

intershop {

    projectInfo {
        productID.set("ICM 7 B2C")
        productName.set("Intershop Commerce Management 7 B2C")
        copyrightOwner.set("Intershop Communications")
        copyrightFrom.set("2005")
        organization.set("Intershop Communications")
    }

    mavenPublicationName.set("ishmvn")

    projectConfig {
        cartridges.set(listOf("com.intershop.cartridge:cartridge_dev:1.0.0",
                       "projectCartridge_prod",
                       "com.intershop.cartridge:cartridge_prod:1.0.0",
                       "projectCartridge_test"))

        dbprepareCartridges.set(listOf("projectCartridge_prod",
                                "com.intershop.cartridge:cartridge_prod:1.0.0"))

        base {
            dependency.set("com.intershop.icm:icm-as:1.0.0")
        }

        modules {
            register("solr") {
                dependency.set("com.intershop.search:solrcloud:1.0.0")
            }
            register("payment") {
                dependency.set("com.intershop.payment:payment:1.0.0")
            }
        }
        serverDirConfig {
            base {
                sites {
                    dirs {
                        register("main") {
                            dir.set(file("sites/base"))
                        }
                    }
                }
                config {
                    dirs {
                        register("main") {
                            dir.set(file("config/base"))
                        }
                    }
                }
            }
            prod { }
            test { }
            dev { }
        }
    }
}
----
++++
</details>
++++



=== Tasks
The ICM Build Gradle plugin adds ... to the project.


[cols="25%,30%,45%", width="90%, options="header"]
|===
|Task name                          | Type                              |Description
|===

== Project Extension 'intershop'
This plugin adds an extension *`intershop`* to the project.

=== Methods
[cols="20%,15%,65%", width="90%", options="header"]
|===
|Method  | Values | Description
|===

===== Properties

[cols="25%,10%,10%,55%", width="90%, options="header"]
|===
|Property | Type | Default value | Description
|===

===== Methods

[cols="17%,17%,66%", width="90%, options="header"]
|===
|Method | Parameter | Description
|===

== License

Copyright 2014-2020 Intershop Communications.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
